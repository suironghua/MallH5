<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta content="telephone=no" name="format-detection">
<link href="css/index.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.min.js" ></script>
<title>商品详情cont</title>
<style>
</style>
</head>

<body style="height:61.33rem;position:relative;">
    <div class="flex head-line">
        <div class="flex-1">
            <a href="Index.html">
                <div style="margin-left:1rem;width:1.42rem;height:2.42rem;margin-top:.8rem;">
                    <img style="width:100%;height:100%;" src="Picture/back.png" />
                </div>
            </a>
        </div>
        <div class="flex-1 head-line-box-m">
            <h3 style="font-size:1.8rem;">商品详情</h3>
        </div>
        <div class="flex-1 head-line-box-r padd-r1"><a>规则说明</a></div>
    </div>
    <div style="height:5rem;"></div>

    <div id="product-page-cent-mian">
    	<div id="product-page-cent-mian-top">
        	<div id="product-page-cent-mian-top-img">
            	<img src="" style="width:100%;height:100%;" />
            </div>
        </div>
        <div id="product-page-cent-mian-middle">
        	<dl>
            	<dt><span style="width:3.42rem;height:1.4rem;font-size:1rem;color:#FFB300;display:inline-block;border:1px solid #FFB300;text-align:center;">进行中</span>（抽奖奖品）Iphone6s plus</dt>
                <dd>所需积分&nbsp;&nbsp;<strong class="point">368800</strong>&nbsp;&nbsp;积分</dd>
                <dd style="padding-top:.3rem">市场参考价：<span>4000.00元</span></dd>
            </dl>
        </div>
    </div>
    <div id=-"product-page-cent-mian-foot">
    	    <div id="product-page-cent-mian-foot-top">
            	<div style="margin-top:1.4rem;">
                    <span style="width:.3rem;height:1.3rem;background:#42a6f4;display:inline-block;margin-left:1rem;border-radius:3px solid #42a6f4;"></span>
                    <span>夺宝进度</span>
                </div>
                <div style="clear:both;"></div>
                
                    <div class="product-page-cent-test-box">
                        <div class="product-page-cent-test-line"></div>
                    </div>
                    <span><a class="a1">1000</a>/<a class="a2">5000</a></span>
                
            </div>
            
            <div style="clear:both;"></div>
        	
            <span class="product-page-cent-mian-foot-number">参与抽奖次数</span>
            
            <form id="ParametersNumber" name="ParametersNumber">
            
                <div class="flex h2" style="padding:1rem 0;">
                    <div class="flex-1 h2"></div>
                    <div>
                        <input id="ProId" type="text" name="id" value="1" style="display:none;" />
                        <button id="pro-cont-btn-pre" type="button">
                            <div style="height:13px;width:13px;margin-left:0.5rem;">
                                <img style="width:100%;height:100%;" src="Picture/jian.png" />
                            </div>
                        </button>
                        <input id="pro-cont-text" name="num" type="text" value="1" />
                        <button id="pro-cont-btn-next" type="button">
                            <div style="height:13px;width:13px;margin-left:0.5rem;">
                                <img style="width:100%;height:100%;" src="Picture/jia.png" />
                            </div>
                        </button>
                    </div>
                    <div class="flex-1 h2"></div>
                </div>
                <div>
                   
                    <div>
                        <input id="tijiao2" class="tijiao" type="button" value="买！买！买！" />  
                    </div
                ></div>
                
           </form> 
        
    </div>
</body>
<script>

$(function(){
	
	var Access_token=sessionStorage.getItem('Access_token');
	GetUrl(Access_token);
	
	ButtonClick();
	
	$('#tijiao2').click(function(){
		show_confirm();
		});
	
	});




function ButtonClick(){
	
	$('#pro-cont-btn-next').click(function(){
		$('#pro-cont-text').val(parseInt($('#pro-cont-text').val())+1)
		});	
	$('#pro-cont-btn-pre').click(function(){
		if($('#pro-cont-text').val()<=0)
		{$('#pro-cont-text').val()=0}
		else{
		$('#pro-cont-text').val(parseInt($('#pro-cont-text').val())-1)
		};
		});	
		
		
		var n1=$('.a1').text()
		var n2=$('.a2').text()
		var bfb=(n1/n2)*30
		var s = bfb.toString()+'rem'
			
//	$('.product-page-cent-test-line').animate({width:s});	
	$('.product-page-cent-test-line').css('width',s)	
	};
	
function show_confirm(){
	var r=confirm("确认购买吗？");
	if (r==true)
	  {
	  var Access_token=sessionStorage.getItem('Access_token');
	  PostMessage(Access_token);
	  }
	else
	  {
	  alert("购买失败！");
	  }
	};
	
	

function GetUrl(s){
	
	var Gurl=window.location.search;
	var NewUrl=Gurl.substring(4);
	
		
	$.ajax({
		type: "get",
		url : 'http://192.168.16.2/api/pointLottery/'+NewUrl,
		dateType:"json",
		data:{
			 
		},
		headers:{
			
			'Authorization':'Bearer '+s
	
		},         
		success:function(data){
			
			$('#product-page-cent-mian-top-img').children('img').attr('src',data.Icon);
			$('#product-page-cent-mian-middle').children('dl').children('dt').html('<strong>（抽奖奖品）'+data.Name+'</strong>');
			$('.point').html(data.point)
			},
		error:function () {
			alert('图片加载失败')
			}
	});
}

function PostMessage(s){
	
	var Gurl=window.location.search;
	var NewUrl=Gurl.substring(4);
	var Val=$('#pro-cont-text').val();    //购买数量
	
	$('#ProId').val(NewUrl);
	var ProIdVal=$('#ProId').val();       //物品的ID
	
	var MyUrl='http://192.168.16.2/api/pointLottery?id='+ProIdVal+'&num='+Val;  //提交地址。
	//var MyUrl='http://192.168.16.2/api/pointLottery';
	
	$.ajax({
		type: "post",
		url : MyUrl,
		dateType:"json",
		data:{
			 id:ProIdVal,
			 num:Val
		},
		async: false,
		headers:{
			'Authorization':'Bearer '+s
		},         
		success:function(data){
			
			
			alert("已购买！");
			},
			
			error: function (data) {
			alert("购买失败！");
			}
	});
	
};
	
	
	
	
function GetToken(){
	        var a = "baoluo_ios";
            var b = "123456";
			var result="";	
		$.ajax({
		    url: 'http://192.168.16.2/home/GetToken',
			
		    data: JSON.stringify({
			        ClientId: 'baoluo_ios',
					UserName: '13622386740',
					PassWord: '123456',
			}),
		   //服务器返回json格式数据
			dateType:"json",
			type: "Post", //HTTP请求类型
			async: false,
			headers:{
				'Content-Type': 'application/json'
			},
			success: function (data) {
				
				var Datajson = eval('(' + data + ')'); 
				
				
				result=Datajson.access_token;
				return result;
	
				},
			error: function (data) {
				var result = data.responseText;

				alert(result)
			}

		});
		return result;
};

</script>
</html>
